# システムワークフロー（計画生産）

## 1. 製造部門
1. ロボットを組み立てる。  
2. 完成したロボットに **ロボット本体シリアル番号** を発行する。  
3. ロボットを構成する各ユニット（ASSY）に **ASSYシリアル番号** を発行する。  
4. ロボット本体シリアルと ASSY シリアルを紐づける。  
5. この段階ではまだバンドルに含まれないため、状態は **「在庫（未バンドル）」** として保持する。  

---

## 2. 営業部門
1. 商談が成立し、受注が確定する。  
2. **商談番号 + 受注セット数** を基に、**製造番号** を発行する。  
3. 製造番号とバンドルは常に **1対1の関係** で作成される。  
4. この時点ではバンドルの内容は未定義（空の箱の状態）。  

---

## 3. 設計部門
1. 発行された製造番号に対応する **バンドルの構成** を定義する。  
2. どの構成品シリアル（ロボット・コントローラ・ケーブルなど）を含めるかを決定する。  
3. バンドル構成が確定することで、出荷対象のセットが設計上定義される。  

---

## 4. 検査・在庫管理部門
1. 実際に完成品や部品のシリアル番号をスキャンする。  
2. バンドルに登録された構成内容に従って、シリアル番号を紐づける。  
3. 紐づけ対象とならなかった構成品（例：余剰ロボットなど）は **在庫** として保持する。  
4. こうして、製造番号 → バンドル → 構成品シリアルの最終的な紐づけが完了する。  

---

## ポイント
- **ASSY階層は最初に確定**（ロボット製造時点で作成）。  
- **製造番号とバンドルは常に1対1**。  
- **バンドル構成は設計部門が定義**する。  
- **シリアル番号を持つすべての構成品が対象**で、紐づけられない場合は在庫管理へ回る。  


## 1. ワークフロー（部門別）

flowchart TD
    subgraph 製造部門
        A1[ロボット組立]
        A2[ロボットシリアル発行]
        A3[ASSYシリアル発行]
        A4[ロボット⇔ASSY紐づけ]
        A5[在庫状態で保持]
        A1 --> A2 --> A3 --> A4 --> A5
    end

    subgraph 営業部門
        B1[受注確定]
        B2[製造番号発行]
        B3[バンドル作成 (1:1)]
        B1 --> B2 --> B3
    end

    subgraph 設計部門
        C1[バンドル構成定義]
        C2[必要なシリアルを設計]
        C1 --> C2
    end

    subgraph 検査・在庫部門
        D1[構成品シリアルをスキャン]
        D2[バンドルに紐づけ]
        D3[未使用シリアルは在庫保持]
        D1 --> D2
        D1 --> D3
    end

    A5 --> C1
    B3 --> C1
    C2 --> D1


## 2.ER図

    erDiagram
    MANUFACTURING_NUMBER ||--|| BUNDLE : "1対1"
    BUNDLE ||--o{ COMPONENT_SERIAL : "含む"
    ROBOT ||--o{ ASSY : "構成する"
    COMPONENT_SERIAL {
        string Serial_ID PK
        string Type  "構成品種別 (Robot/Controller/Cable/Assy)"
        string Status "在庫/使用中"
    }
    MANUFACTURING_NUMBER {
        string MFG_ID PK
        string Sales_Order_ID "商談番号"
        int Quantity "受注セット数"
    }
    BUNDLE {
        string Bundle_ID PK
        string MFG_ID FK
        string Design_Status "設計部門で構成確定"
    }
    ROBOT {
        string Robot_ID PK
        string Serial_ID FK
    }
    ASSY {
        string Assy_ID PK
        string Robot_ID FK
    }


---


# システムワークフロー（受注生産）

## 1. ワークフロー（言語化）

### 営業部門
1. 商談が成立し、受注が確定する。  
2. 商談番号＋受注セット数を基に **製造番号** を発行する。  
3. 製造番号とバンドルは **1対1** で作成される（空の状態）。  

---

### 設計部門
1. 製造番号に対して **バンドル構成** を定義する。  
2. 必要となる構成品（ロボット、コントローラ、ケーブルなど）をシリアル単位で設計上確定する。  
3. この構成情報をもとに、製造部門に製造依頼を行う。  

---

### 製造部門
1. 設計部門が定義したバンドル構成に従い、製造を開始する。  
2. ロボットを組み立て、**ロボット本体シリアル**を発行する。  
3. ロボットを構成するユニットごとに **ASSYシリアル** を発行し、ロボット本体シリアルと紐づける。  
4. 完成した構成品は、在庫を経由せず直接バンドルに割り当てられる。  

---

### 検査部門
1. 完成した構成品シリアルをスキャンする。  
2. 設計部門で定義されたバンドル内容に従ってシリアルを紐づける。  
3. 紐づけが完了した時点で、製造番号に対応するバンドルが完成する。  
4. 検査完了後、出荷可能状態となる。  

---

## 2. ワークフロー図（Mermaid）

flowchart TD
    subgraph 営業部門
        A1[商談成立・受注確定]
        A2[製造番号発行]
        A3[バンドル作成 (1:1)]
        A1 --> A2 --> A3
    end

    subgraph 設計部門
        B1[バンドル構成定義]
        B2[構成品シリアルを設計上確定]
        B1 --> B2
    end

    subgraph 製造部門
        C1[製造開始]
        C2[ロボットシリアル発行]
        C3[ASSYシリアル発行・紐づけ]
        C4[完成品をバンドルへ直結]
        C1 --> C2 --> C3 --> C4
    end

    subgraph 検査部門
        D1[構成品シリアルをスキャン]
        D2[バンドルへ紐づけ]
        D3[出荷可能状態へ]
        D1 --> D2 --> D3
    end

    A3 --> B1
    B2 --> C1
    C4 --> D1

## ポイント
- 製造番号とバンドルは 受注確定後に初めて作成される。
- バンドル構成は設計部門が定義し、その内容をもとに製造部門が製造する。
- ~~完成品は在庫を経由せず、直接バンドルに割り当てられる。~~
- 計画生産と異なり、余剰在庫が発生しにくい。


# 課題
- Android端末側に、どのように設計部の**BOMデータ**を持ってくるか
  (BOMデータからシリアル管理するユニットを抽出したいため)