# Androidアプリ設計書（修正版）

## 1. 目的
- 製造部門／検査部門の担当者が、現場でシリアル番号を正確に紐づけられるようにする。
- ERPとは役割を分担し、Androidはあくまで **「シリアル紐づけと検査」** を担う。
- オフライン対応と夜間自動同期をサポートする。

---

## 2. 利用者
- 製造部門の現場担当者（ASSY登録、ロボット⇔ASSY紐づけ）
- 検査部門の担当者（製造番号ごとのバンドル紐づけ、検査結果登録）

---

## 3. 主な機能（修正版）
1. **ログイン・認証**
   - **夜間自動同期**：端末認証方式（デバイス証明書などで無人同期）  
   - **手動同期**：ユーザー認証方式（ID/パスワード or SSO）  

2. **作業選択メニュー**
   - バンドル紐づけ作業
   - ロボット⇔ASSY紐づけ確認
   - （在庫処理は ERP 側で実施 → Android は担当外）

3. **シリアルスキャン**
   - **端末付属のQRスキャナ**を利用
   - 読み取り後に即時チェック（重複、型式不一致、ASSY不足など）
   - 連続スキャンモード対応

4. **バンドル紐づけ**
   - サーバから取得したバンドル構成に基づき、シリアルをスキャンして紐づけ
   - 構成品不足／過剰はエラー表示
   - 完了後、バンドルを「作業済み」としてマーク

5. **ロボット⇔ASSY管理**
   - ロボット本体シリアルとASSYシリアルの関係を確認／登録
   - 検査時に必須チェック

6. **検査結果登録**
   - シリアルごとに PASS/FAIL を入力
   - FAIL 時は理由入力（定型選択＋自由記述）

7. **オフライン対応**
   - 作業結果をローカルSQLiteに保存
   - **同期定義：**
     - Android → DB：  
       - 「製造番号と紐づけたシリアル管理品」  
       - 「作業を終えたバンドル」  
       - → サーバに送信完了後、Androidから削除
     - DB → Android：  
       - 「製造番号と紐づいていないシリアル管理品」  
       - 「まだ実施していないバンドル」  

---

## Androidアプリ 画面設計（修正版）

## 1. ログイン画面
### 機能
- ユーザーが作業開始前にログインする。
- QRコードを読み取り → 従業員コード入力 → 認証。
- このログインユーザーが作業担当者として記録される。

### UI要素
- QRコードスキャンボタン
- 従業員コード入力欄
- ログインボタン

---

## 2. 作業選択画面
### 機能
- 作業種別を選ぶ画面。

### ボタン
- 「バンドル紐づけ」
- 「ロボット合体」（旧「ASSY確認」）

---

## 3. バンドル紐づけ画面
### 機能
- 設計部が定義したバンドルリストを参照可能。
- そのうち **シリアル管理対象のみ** を表示する。
- 製造番号と構成品シリアルをQRコードでスキャンし、バンドルに当てはめていくUX。

### UI要素
- 上部：対象バンドルの製造番号・ステータス
- 中央：構成品リスト（シリアル管理品のみ）
  - 項目例：ロボット、コントローラ、ケーブル  
  - 各行に「未登録／登録済」表示
- 下部：不足／過剰の警告エリア
- ボタン：「スキャン開始」「完了」

---

## 4. ロボット合体画面（旧ASSY確認）
### 機能
- ロボット本体と、それに紐づく部品（ASSY群）のリストを表示。
- ロボット本体シリアルをスキャンし、その後ASSYシリアルをスキャンして当てはめる。
- UXは「ロボット合体」＝ ロボット本体と部品を結合するイメージ。

### UI要素
- 上部：ロボット本体シリアル（登録済 or 未登録）
- 中央：ASSY部品リスト（シリアル管理品のみ）
  - 各行に「未登録／登録済」表示
- ボタン：「スキャン開始」「合体完了」

---

## 5. 検査画面
### 機能
- バンドルに含まれるシリアルの検査結果を入力。
- 合否をシリアルごとに入力し、FAIL時は理由も記録。
- 「完了」ボタンを押すと、ローカルDBに「完了データ」として更新される。

### UI要素
- 上部：対象バンドルID／製造番号
- 中央：シリアル一覧 + PASS/FAIL 選択
- FAIL選択時 → 理由入力欄（プルダウン＋自由記述）
- 下部：「完了」ボタン → DB更新

---

## 6. データ保存動作（共通）
- 各作業（バンドル紐づけ、ロボット合体、検査）で「完了」ボタン押下時にローカルSQLiteを更新。
- レコードは「作業完了済み」とマークされ、夜間自動同期 or 手動同期でサーバに送信される。


---

## 5. オフラインと同期
- **ローカルDB(SQLite)**  
  - `work_done`：完了した作業（同期対象）  
  - `work_todo`：未実施バンドル・未紐づけシリアル  
  - `serial_link`：ロボット⇔ASSYの紐づけ状態  

- **同期方法**  
  - 夜間自動同期（端末認証、無人処理）  
  - 手動同期（ユーザー認証、オンデマンド）  
  - API呼出しで差分転送、冪等キーで二重登録を防止  

---

## 6. エラー・通知
- スキャン重複 → 「登録済みシリアルです」  
- 型式不一致 → 「設計定義と異なる構成品です」  
- ASSY不足 → 「ASSYが未登録です」  
- サーバ同期失敗 → 「オフライン保存済み。次回同期時に送信されます」  

---

## 7. 非機能要件
- 工場現場で使える片手操作  
- スキャン1件あたり処理時間 < 2秒  
- オフライン状態で1日分の作業を保持（約1万件）  
- 夜間自動同期時はユーザー操作不要  

---